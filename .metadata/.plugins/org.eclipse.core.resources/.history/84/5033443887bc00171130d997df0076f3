package composite.order.service;

import java.net.URI;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.client.RestTemplate;

import composite.order.model.Order;

public class OrderCompositeIntegration {

	private static final Logger LOG = LoggerFactory.getLogger(OrderCompositeIntegration.class);
	
	@Autowired
	Util util;
	
	private RestTemplate restTemplate = new RestTemplate();
	
	public ResponseEntity<Order> getOrder(long orderId) {
        URI uri = util.getServiceUrl("order-service");
        String url = uri.toString() + "/order/" + orderId;
        LOG.debug("Getting Order from URL: {}", url);

        ResponseEntity<String> resultStr = restTemplate.getForEntity(url, String.class);
        LOG.debug("Get Order http-status: {}", resultStr.getStatusCode());
        LOG.debug("Get Order body: {}", resultStr.getBody());

        Order order = util.response2Order(resultStr);
        LOG.debug("GetOrder.id: {}", order.getOrderId());

        return util.createOkResponse(order);
    }
}
